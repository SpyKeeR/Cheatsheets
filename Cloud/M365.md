# ‚òÅÔ∏è Microsoft 365 ‚Äî Aide-m√©moire

## üë§ Entra ID (Azure AD) ‚Äî Identity & Access

### Types d'Identit√©s
| Type | Description | Sync | Use Case |
|------|-------------|------|----------|
| **Cloud-only** | Cr√©√© dans Entra ID | Non | Organisation cloud-native |
| **Synchronized** | AD local ‚Üí Entra ID | Oui | Environnement hybride |
| **Federated** | Auth via AD FS/SAML | Oui | SSO complexe |
| **Guest** | Utilisateur externe | Non | Collaboration B2B |

### Gestion Utilisateurs
```powershell
# Cr√©ation utilisateur
New-MgUser -AccountEnabled -DisplayName "Jean Dupont" -UserPrincipalName "jdupont@domain.com" -MailNickname "jdupont" -PasswordProfile @{Password="TempPass123!";ForceChangePasswordNextSignIn=$true}

# Gestion licences
Get-MgSubscribedSku  # Lister SKU disponibles
Set-MgUserLicense -UserId "jdupont@domain.com" -AddLicenses @{SkuId="sku-guid"}
Set-MgUserLicense -UserId "jdupont@domain.com" -RemoveLicenses @("sku-guid")

# D√©sactiver expiration mot de passe (cloud-only)
Update-MgUser -UserId "jdupont@domain.com" -PasswordPolicies "DisablePasswordExpiration"
```

### Types de Groupes
- **Distribution** : Mailing lists classiques
- **Microsoft 365** : Collaboration (SharePoint, Teams, mailbox partag√©e)
- **Security** : Contr√¥le d'acc√®s aux ressources
- **Dynamic** : Adh√©sion bas√©e sur r√®gles automatiques
- **Role-assignable** : Peut recevoir des r√¥les Entra ID

### RBAC ‚Äî Roles & Permissions
```
Administrateurs recommand√©s (principe du moindre privil√®ge) :
‚îú‚îÄ‚îÄ Global Administrator (1-2 comptes max)
‚îú‚îÄ‚îÄ User Administrator (gestion utilisateurs)
‚îú‚îÄ‚îÄ License Administrator (attribution licences)
‚îú‚îÄ‚îÄ Helpdesk Administrator (r√©initialisation MDP)
‚îú‚îÄ‚îÄ Exchange Administrator (gestion Exchange)
‚îú‚îÄ‚îÄ Teams Administrator (gestion Teams)
‚îú‚îÄ‚îÄ Security Administrator (politiques s√©curit√©)
‚îî‚îÄ‚îÄ Compliance Administrator (conformit√©)
```

### Entra Connect (Hybrid Identity)
```bash
# Pr√©requis synchronisation
1. Suffixe UPN ajout√© dans AD local
2. UPN align√©s avec domaines M365
3. Compte service d√©di√© (non-expiration)
4. Serveur d√©di√© ou VM
5. Connectivit√© HTTPS sortante

# Cycle de synchronisation
Start-ADSyncSyncCycle -PolicyType Delta    # Incr√©mental (30min auto)
Start-ADSyncSyncCycle -PolicyType Initial  # Complet
```

## üìß Exchange Online

### Types de Bo√Ætes aux Lettres
| Type | Description | Licence | Acc√®s |
|------|-------------|---------|-------|
| **User Mailbox** | BAL utilisateur standard | Oui | Propri√©taire + d√©l√©gu√©s |
| **Shared Mailbox** | BAL partag√©e √©quipe | Non* | Membres avec permissions |
| **Resource Mailbox** | Salle/√©quipement | Non | R√©servation automatique |
| **Archive Mailbox** | Archivage long terme | Plan 2 | Utilisateur propri√©taire |

*Gratuite si <50GB et utilisateurs ont licence Exchange

### Plans Exchange Online
- **Plan 1** : 50GB bo√Æte + 50GB archive
- **Plan 2** : 100GB bo√Æte + archive auto-extensible + Compliance avanc√©e

### Configuration DNS Essentielle
```dns
# Domaine validation
TXT @ "MS=ms12345678"

# Exchange Online
MX @ "domain-com.mail.protection.outlook.com" (priorit√© 0)
CNAME autodiscover "autodiscover.outlook.com"

# S√©curit√© email
TXT @ "v=spf1 include:spf.protection.outlook.com -all"
CNAME selector1._domainkey "selector1-domain-com._domainkey.domain.onmicrosoft.com"
TXT _dmarc "v=DMARC1; p=quarantine; rua=mailto:dmarc@domain.com"
```

### Gestion Bo√Ætes Partag√©es
```powershell
# Cr√©er bo√Æte partag√©e
New-Mailbox -Shared -Name "Support IT" -Alias "support-it"

# Ajouter permissions
Add-MailboxPermission -Identity "support-it" -User "jdupont@domain.com" -AccessRights FullAccess
Add-RecipientPermission -Identity "support-it" -Trustee "jdupont@domain.com" -AccessRights SendAs

# Configuration quotas
Set-Mailbox -Identity "jdupont@domain.com" -IssueWarningQuota 49GB -ProhibitSendQuota 49.5GB -ProhibitSendReceiveQuota 50GB
```

### S√©curit√© Email (SPF/DKIM/DMARC)
- **SPF** : Autorise servers √† envoyer pour le domaine
- **DKIM** : Signature cryptographique des messages  
- **DMARC** : Politique de traitement des √©checs SPF/DKIM
- **Recommandation** : Impl√©menter les 3 pour protection optimale

### Ports & Protocoles
| Service | Port Standard | Port S√©curis√© | Usage |
|---------|---------------|---------------|-------|
| **HTTPS/MAPI** | ‚Äî | 443 | Outlook desktop |
| **ActiveSync** | ‚Äî | 443 | Mobiles/tablettes |
| **IMAP4** | 143 | 993 | Clients tiers |
| **POP3** | 110 | 995 | Clients basiques |
| **SMTP** | 25/587 | 465/587 | Envoi/relay |

## ü§ù Microsoft Teams

### Administration Teams
```
Teams Admin Center ‚Üí Contr√¥le :
‚îú‚îÄ‚îÄ Cr√©ation d'√©quipes (autoriser/restreindre)
‚îú‚îÄ‚îÄ Politiques de messagerie
‚îú‚îÄ‚îÄ Politiques de r√©union
‚îú‚îÄ‚îÄ Applications autoris√©es
‚îú‚îÄ‚îÄ Num√©rotation (t√©l√©phonie)
‚îî‚îÄ‚îÄ Compliance & r√©tention
```

### Gouvernance Teams
- **Limitation cr√©ation** : Restreindre √† un groupe d'utilisateurs autoris√©s
- **Naming Policy** : Convention nommage automatique
- **Expiration Groups** : Suppression auto si inactifs
- **Classification** : √âtiquetage sensibilit√© (Public/Private/Highly Confidential)

## üõ°Ô∏è S√©curit√© & Compliance

### Multi-Factor Authentication (MFA)
```
Configuration MFA :
‚îú‚îÄ‚îÄ Entra ID ‚Üí Security ‚Üí MFA
‚îú‚îÄ‚îÄ M√©thodes : App Authenticator (recommand√©), SMS, Appel
‚îú‚îÄ‚îÄ Conditional Access : R√®gles contextuelles
‚îî‚îÄ‚îÄ Per-user MFA : Configuration individuelle (legacy)
```

### Conditional Access Policies
```
R√®gles courantes :
‚îú‚îÄ‚îÄ Bloquer pays √† risque
‚îú‚îÄ‚îÄ Exiger MFA hors r√©seau corporate
‚îú‚îÄ‚îÄ Bloquer clients legacy (Basic Auth)
‚îú‚îÄ‚îÄ Exiger appareils conformes/joints
‚îî‚îÄ‚îÄ Contr√¥le session (Cloud App Security)
```

### Microsoft Defender for Office 365
- **Plan 1** : Safe Attachments, Safe Links, Anti-phishing
- **Plan 2** : + Threat Investigation, Attack Simulation, Automated Response

### Compliance & Data Loss Prevention
```
Fonctionnalit√©s Compliance :
‚îú‚îÄ‚îÄ Retention Policies (conservation donn√©es)
‚îú‚îÄ‚îÄ Data Loss Prevention (DLP)
‚îú‚îÄ‚îÄ Information Protection (√©tiquetage)
‚îú‚îÄ‚îÄ Insider Risk Management
‚îú‚îÄ‚îÄ Communication Compliance
‚îî‚îÄ‚îÄ eDiscovery (Advanced eDiscovery Plan 2)
```

## üì± Microsoft Intune (MDM/MAM)

### Mod√®les de D√©ploiement
- **BYOD** : Bring Your Own Device (appareil personnel)
- **CYOD** : Choose Your Own Device (choix dans catalogue)
- **COPE** : Corporate Owned, Personally Enabled (propri√©t√© entreprise, usage mixte)

### Configuration DNS Intune
```dns
CNAME EnterpriseEnrollment "EnterpriseEnrollment.manage.microsoft.com"
CNAME EnterpriseRegistration "EnterpriseRegistration.windows.net"
```

### Enrollment Methods
1. **Settings** ‚Üí "Acc√®s professionnel ou scolaire" ‚Üí S'inscrire
2. **Company Portal App** ‚Üí Autoriser gestion organisation
3. **Autopilot** : Provisioning automatique (Windows)
4. **Apple DEP/ADE** : Enrollment iOS/macOS g√©r√©

### Policies Types
- **Configuration Profiles** : Param√®tres appareil (Wi-Fi, VPN, certificats)
- **Compliance Policies** : Exigences s√©curit√© (chiffrement, PIN, jailbreak)
- **App Protection** : Gestion donn√©es apps (copier/coller, sauvegarde)
- **Windows Information Protection** : S√©paration donn√©es pro/perso

## üìÅ SharePoint Online & OneDrive

### Capacit√©s Stockage
- **OneDrive** : 1TB par d√©faut, jusqu'√† 5TB selon licence
- **SharePoint** : 1TB + 10GB par licence utilisateur
- **Site Collection** : Maximum 25TB par site

### Gouvernance SharePoint
```
Contr√¥les recommand√©s :
‚îú‚îÄ‚îÄ Limitation cr√©ation sites (groupe autoris√©)
‚îú‚îÄ‚îÄ Classifications sites (Public/Internal/Confidential)
‚îú‚îÄ‚îÄ Retention policies par type contenu
‚îú‚îÄ‚îÄ External sharing restrictions
‚îî‚îÄ‚îÄ DLP policies pour documents sensibles
```

## ‚ö° PowerShell pour M365

### Modules Essentiels
```powershell
# Installation modules modernes
Install-Module Microsoft.Graph -Scope CurrentUser
Install-Module PnP.PowerShell -Scope CurrentUser
Install-Module ExchangeOnlineManagement -Scope CurrentUser
Install-Module MicrosoftTeams -Scope CurrentUser

# Connexions
Connect-MgGraph -Scopes "Directory.ReadWrite.All","User.ReadWrite.All"
Connect-ExchangeOnline -UserPrincipalName admin@domain.com
Connect-PnPOnline -Url "https://tenant.sharepoint.com" -Interactive
Connect-MicrosoftTeams
```

### Migration MSOnline ‚Üí Microsoft.Graph
| MSOnline (Legacy) | Microsoft.Graph (Modern) |
|-------------------|--------------------------|
| `Connect-MsolService` | `Connect-MgGraph` |
| `Get-MsolUser` | `Get-MgUser` |
| `New-MsolUser` | `New-MgUser` |
| `Set-MsolUser` | `Update-MgUser` |
| `Get-MsolRole` | `Get-MgDirectoryRole` |

### Gestion R√¥les Administration
```powershell
# Lister templates r√¥les
Get-MgDirectoryRoleTemplate

# Activer r√¥le
Enable-MgDirectoryRole -RoleTemplateId "role-template-id"

# Ajouter utilisateur √† r√¥le
$params = @{
    "@odata.id" = "https://graph.microsoft.com/v1.0/users/user-id"
}
New-MgDirectoryRoleMemberByRef -DirectoryRoleId "role-id" -BodyParameter $params

# Lister r√¥les d'un utilisateur
Get-MgUserAppRoleAssignment -UserId "user-id"
```

### Bulk Operations
```powershell
# Attribution licence en masse
$users = Get-MgUser -Filter "Department eq 'Sales'"
foreach ($user in $users) {
    Set-MgUserLicense -UserId $user.Id -AddLicenses @{SkuId="sku-guid"}
}

# Cr√©ation utilisateurs par CSV
$csv = Import-Csv "users.csv"
foreach ($row in $csv) {
    New-MgUser -AccountEnabled -DisplayName $row.DisplayName -UserPrincipalName $row.UPN -PasswordProfile @{Password=$row.Password;ForceChangePasswordNextSignIn=$true}
}
```

## üöÄ D√©ploiement Office

### Office Deployment Tool (ODT)
```xml
<!-- Configuration.xml exemple -->
<Configuration>
  <Add OfficeClientEdition="64" Channel="Current">
    <Product ID="O365ProPlusRetail">
      <Language ID="fr-fr" />
      <Language ID="en-us" />
      <ExcludeApp ID="Access" />
      <ExcludeApp ID="Publisher" />
    </Product>
  </Add>
  <Property Name="SharedComputerLicensing" Value="1" />
  <Property Name="FORCEAPPSHUTDOWN" Value="TRUE" />
  <Updates Enabled="TRUE" />
  <Display Level="None" AcceptEULA="TRUE" />
</Configuration>
```

```bash
# D√©ploiement ODT
setup.exe /download Configuration.xml    # T√©l√©chargement
setup.exe /configure Configuration.xml   # Installation
```

### Group Policy Deployment
1. Cr√©er partage r√©seau accessible par ordinateurs cibles
2. Script d√©marrage GPO : `\\server\share\setup.exe /configure \\server\share\configuration.xml`
3. Appliquer sur OU contenant ordinateurs cibles
4. Droits admin local requis sur postes

## üìä Licensing & Plans

### Plans Principaux
| Plan | Exchange | SharePoint | Teams | Office Apps |
|------|----------|------------|-------|-------------|
| **Business Basic** | 50GB | 1TB | ‚úÖ | Web only |
| **Business Standard** | 50GB | 1TB | ‚úÖ | Desktop + Web |
| **Business Premium** | 50GB | 1TB | ‚úÖ | Desktop + Intune |
| **E3** | 100GB | Unlimited | ‚úÖ | Desktop + Compliance |
| **E5** | 100GB | Unlimited | ‚úÖ | + Security + Analytics |

### Add-ons Importants
- **Exchange Online Plan 2** : Archive auto-extensible
- **Defender for Office 365** : Protection avanc√©e email
- **Power BI Pro/Premium** : Analytics & reporting
- **Project/Visio** : Applications sp√©cialis√©es

## üõ†Ô∏è Monitoring & Troubleshooting

### Service Health
```
Monitoring M365 :
‚îú‚îÄ‚îÄ Admin Center ‚Üí Health ‚Üí Service health
‚îú‚îÄ‚îÄ Message Center : Changements planifi√©s
‚îú‚îÄ‚îÄ Service requests : Support Microsoft
‚îî‚îÄ‚îÄ Usage Reports : Adoption services
```

### Outils Diagnostic
- **Microsoft Remote Connectivity Analyzer** : Test connectivit√© Exchange/Teams
- **Message Trace** : Suivi email (exp√©diteur/destinataire/objet)
- **Call Quality Dashboard** : Qualit√© appels Teams
- **Adoption Score** : Mesure adoption services M365

### Sauvegarde Tierce
‚ö†Ô∏è **Microsoft ne fournit pas de sauvegarde compl√®te** pour r√©cup√©ration point-in-time

Solutions recommand√©es :
- **Veeam Backup for Microsoft 365**
- **SkyKick Cloud Backup**
- **Datto SaaS Protection**
- **Barracuda Cloud-to-Cloud Backup**

## üî• Incident Response & Recovery

### Compte Compromis
1. **Isoler** : D√©sactiver compte imm√©diatement
2. **R√©voquer** : Sessions actives et tokens refresh
3. **Analyser** : Audit logs et activit√© suspecte
4. **Nettoyer** : R√®gles forwarding/delegates malveillants
5. **S√©curiser** : Nouveau MDP + MFA + monitoring renforc√©

### Recovery Scenarios
- **Suppression accidentelle** : Corbeille utilisateur (30j) ‚Üí Corbeille admin (93j)
- **Ransomware** : Isolation + restauration sauvegarde tierce
- **Perte acc√®s admin** : Proc√©dure break-glass Microsoft
- **Corruption donn√©es** : Point-in-time restore (sauvegarde tierce requise)