# üìù Registre Windows ‚Äî Aide-m√©moire

## üèóÔ∏è Architecture du Registre

### Ruches Principales (Hives)
```
Base de Registre Windows:
‚îú‚îÄ‚îÄ HKEY_CLASSES_ROOT (HKCR)
‚îú‚îÄ‚îÄ HKEY_CURRENT_USER (HKCU)  
‚îú‚îÄ‚îÄ HKEY_LOCAL_MACHINE (HKLM)
‚îú‚îÄ‚îÄ HKEY_USERS (HKU)
‚îî‚îÄ‚îÄ HKEY_CURRENT_CONFIG (HKCC)
```

| Ruche | Abr√©viation | Contenu | Usage |
|-------|-------------|---------|--------|
| **HKEY_CLASSES_ROOT** | HKCR | Extensions fichiers, COM | Associations fichiers/applications |
| **HKEY_CURRENT_USER** | HKCU | Profil utilisateur courant | Param√®tres personnels |
| **HKEY_LOCAL_MACHINE** | HKLM | Configuration syst√®me | Param√®tres globaux machine |
| **HKEY_USERS** | HKU | Tous profils utilisateurs | Administration multi-utilisateurs |
| **HKEY_CURRENT_CONFIG** | HKCC | Config mat√©rielle active | Profils mat√©riels |

### Hi√©rarchie & Relations
```
Liens logiques:
HKCR ‚Üí Vue combin√©e de HKLM\SOFTWARE\Classes + HKCU\SOFTWARE\Classes
HKCC ‚Üí Alias vers HKLM\SYSTEM\CurrentControlSet\Hardware Profiles\Current
HKCU ‚Üí Alias vers HKU\{SID utilisateur courant}
```

## üóÇÔ∏è Structure HKEY_LOCAL_MACHINE

### Sous-cl√©s Critiques
```
HKLM\
‚îú‚îÄ‚îÄ HARDWARE          # Mat√©riel d√©tect√© au boot
‚îú‚îÄ‚îÄ SAM               # Security Account Manager (mots de passe)
‚îú‚îÄ‚îÄ SECURITY          # Politiques s√©curit√© locale
‚îú‚îÄ‚îÄ SOFTWARE          # Applications syst√®me
‚îú‚îÄ‚îÄ SYSTEM           # Configuration syst√®me
‚îî‚îÄ‚îÄ BCD00000000      # Boot Configuration Data (UEFI)
```

#### HKLM\SOFTWARE (Applications)
```
SOFTWARE\
‚îú‚îÄ‚îÄ Classes\          # Types fichiers syst√®me
‚îú‚îÄ‚îÄ Microsoft\        # Logiciels Microsoft
‚îÇ   ‚îú‚îÄ‚îÄ Windows\      # Configuration Windows
‚îÇ   ‚îú‚îÄ‚îÄ Windows NT\   # Param√®tres NT
‚îÇ   ‚îî‚îÄ‚îÄ Office\       # Suite Office
‚îú‚îÄ‚îÄ Policies\         # GPO appliqu√©es
‚îî‚îÄ‚îÄ WOW6432Node\      # Apps 32-bit sur syst√®me 64-bit
```

#### HKLM\SYSTEM (Configuration)
```
SYSTEM\
‚îú‚îÄ‚îÄ CurrentControlSet\    # Configuration active (alias)
‚îú‚îÄ‚îÄ ControlSet001\       # Jeu configuration 1
‚îú‚îÄ‚îÄ ControlSet002\       # Jeu configuration 2 (backup)
‚îú‚îÄ‚îÄ Select\             # Pointeur vers ControlSet actif
‚îî‚îÄ‚îÄ Setup\              # Infos installation Windows
```

### Current Control Set
```
CurrentControlSet\
‚îú‚îÄ‚îÄ Control\            # Param√®tres syst√®me globaux
‚îú‚îÄ‚îÄ Enum\              # P√©riph√©riques √©num√©r√©s
‚îú‚îÄ‚îÄ Hardware Profiles\ # Profils mat√©riels
‚îú‚îÄ‚îÄ Policies\          # Politiques locales
‚îî‚îÄ‚îÄ Services\          # Services Windows
```

## üìã Types de Donn√©es

### Types de Valeurs
| Type | Description | Exemple | Usage |
|------|-------------|---------|--------|
| **REG_SZ** | Cha√Æne texte | `"C:\Program Files"` | Chemins, noms |
| **REG_DWORD** | Entier 32-bit | `0x00000001` | Flags, compteurs |
| **REG_QWORD** | Entier 64-bit | `0x0000000000000001` | Grandes valeurs |
| **REG_BINARY** | Donn√©es binaires | `01 FF A3 2C` | Config binaire |
| **REG_MULTI_SZ** | Multi-cha√Ænes | `"ligne1\0ligne2\0"` | Listes |
| **REG_EXPAND_SZ** | Cha√Æne avec variables | `"%SystemRoot%\system32"` | Chemins dynamiques |

### Conventions Valeurs
- **0** = D√©sactiv√©, **1** = Activ√© (bool√©ens)
- **DWORD** en hexad√©cimal : `0x00000001`
- **Cha√Ænes vides** vs **valeurs absentes** : comportements diff√©rents
- **Variables d'environnement** : `%SystemRoot%`, `%ProgramFiles%`

## üîß Outils d'Acc√®s

### Interface Graphique
```cmd
regedit.exe              # √âditeur registre standard
regedt32.exe             # √âditeur avanc√© (Windows NT legacy)
```

#### Navigation regedit
- **Ctrl+F** : Rechercher cl√©/valeur/donn√©es
- **F3** : Recherche suivante
- **F5** : Actualiser
- **Suppr** : Supprimer cl√©/valeur
- **F2** : Renommer

### Ligne de Commande
```cmd
# Requ√™tes
reg query HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion /v ProductName
reg query "HKCU\Control Panel\Desktop" /s    # R√©cursif

# Ajout/Modification
reg add HKCU\Software\MonApp /v Version /t REG_SZ /d "1.0" /f
reg add HKLM\SOFTWARE\MonApp /v Enabled /t REG_DWORD /d 1

# Suppression
reg delete HKCU\Software\MonApp /v Version /f
reg delete HKCU\Software\MonApp /f          # Cl√© enti√®re

# Import/Export
reg export HKCU\Software\MonApp backup.reg
reg import backup.reg
```

### PowerShell (Moderne)
```powershell
# Lecture
Get-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion" -Name ProductName
Get-ChildItem "HKCU:\Software" | Select-Object Name

# √âcriture
Set-ItemProperty "HKCU:\Software\MonApp" -Name "Version" -Value "1.0"
New-ItemProperty "HKCU:\Software\MonApp" -Name "Enabled" -PropertyType DWord -Value 1

# Suppression
Remove-ItemProperty "HKCU:\Software\MonApp" -Name "Version"
Remove-Item "HKCU:\Software\MonApp" -Recurse

# Test existence
Test-Path "HKCU:\Software\MonApp"
```

## üìç Emplacements Cl√©s Importantes

### Configuration Syst√®me
| Chemin | Description | Usage Typique |
|--------|-------------|---------------|
| `HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion` | Version Windows | ProductName, BuildNumber |
| `HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion` | Infos d√©taill√©es NT | ReleaseId, UBR |
| `HKLM\SYSTEM\CurrentControlSet\Control\ComputerName` | Nom ordinateur | ComputerName |
| `HKLM\SOFTWARE\Policies` | GPO machine | Politiques appliqu√©es |
| `HKCU\SOFTWARE\Policies` | GPO utilisateur | Politiques utilisateur |

### Applications & D√©marrage
```
# Applications install√©es
HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\
HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\   # User-only

# D√©marrage automatique
HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\         # Tous utilisateurs
HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\         # Utilisateur courant
HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce\     # Une seule fois

# Services
HKLM\SYSTEM\CurrentControlSet\Services\
```

### Interface Utilisateur
```
# Bureau utilisateur
HKCU\Control Panel\Desktop\
HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\

# Associations fichiers
HKCR\.*                      # Extensions (.txt, .pdf, etc.)
HKCR\Applications\           # Applications d√©clar√©es
```

## üîê S√©curit√© & Permissions

### Permissions Registre
```
Permissions standard:
‚îú‚îÄ‚îÄ Full Control    # Lecture, √©criture, suppression compl√®te
‚îú‚îÄ‚îÄ Read           # Lecture cl√©s et valeurs
‚îú‚îÄ‚îÄ Special        # Permissions personnalis√©es
‚îî‚îÄ‚îÄ Owner          # Propri√©taire (contr√¥le total)

H√©ritage:
‚îú‚îÄ‚îÄ Conteneur parent ‚Üí sous-cl√©s enfants
‚îú‚îÄ‚îÄ Possibilit√© bloquer h√©ritage
‚îî‚îÄ‚îÄ Permissions explicites > h√©rit√©es
```

### Acc√®s S√©curis√©
```cmd
# Prendre possession (ownership)
takeown /f "HKLM\SOFTWARE\MonApp" /r /d y

# Modifier permissions via icacls (fichiers reg export√©s)
icacls backup.reg /grant "Administrators:F"

# Via PowerShell (ACL)
$acl = Get-Acl "HKLM:\SOFTWARE\MonApp"
$acl.SetOwner([System.Security.Principal.NTAccount]"Administrators")
Set-Acl "HKLM:\SOFTWARE\MonApp" $acl
```

## üíæ Sauvegarde & Restauration

### Export/Import Complet
```cmd
# Export ruche compl√®te
reg export HKCU C:\Backup\HKCU_backup.reg
reg export HKLM C:\Backup\HKLM_backup.reg

# Export s√©lectif
reg export "HKCU\Software\Microsoft\Office" C:\Backup\Office.reg

# Import (attention : √©crase existant)
reg import C:\Backup\HKCU_backup.reg

# Import silencieux
regedit /s C:\Backup\Office.reg
```

### Points de Restauration
- **Cr√©ation** : Automatique avant modifications importantes
- **Localisation** : Inclut √©tat registre
- **Restauration** : Via `rstrui.exe` ou WinRE

### Sauvegarde Syst√®me
```cmd
# Sauvegarde manuelle ruches
copy C:\Windows\System32\config\SOFTWARE C:\Backup\SOFTWARE.bak
copy C:\Windows\System32\config\SYSTEM C:\Backup\SYSTEM.bak
# (n√©cessite mode hors ligne ou PE)

# Via wbadmin (sauvegarde syst√®me compl√®te)
wbadmin start backup -backupTarget:E: -include:C: -allCritical -quiet
```

## üîç Diagnostic & D√©pannage

### Probl√®mes Courants
| Sympt√¥me | Cause Probable | Solution |
|----------|---------------|----------|
| **Associations fichiers** | HKCR corrompu | `sfc /scannow`, rebuild associations |
| **Services ne d√©marrent pas** | Registre Services corrompu | V√©rifier `HKLM\SYSTEM\...\Services` |
| **Profil utilisateur** | HKCU inaccessible | Nouveau profil, migration donn√©es |
| **Erreurs permissions** | ACL registre restrictives | `takeown`, modifier permissions |

### Commandes Diagnostic
```cmd
# V√©rifier int√©grit√© registre
sfc /scannow                  # System File Checker
DISM /Online /Cleanup-Image /RestoreHealth

# Audit registre
auditpol /get /category:"Object Access"
eventvwr.msc                  # Event Viewer pour erreurs registre

# Monitoring modifications temps r√©el
procmon.exe                   # Process Monitor (filter Registry)
```

### R√©paration Registre
```cmd
# Mode sans √©chec + r√©paration
# F8 > Safe Mode > cmd
chkdsk C: /f                  # V√©rifier syst√®me fichiers
sfc /scannow                  # R√©parer fichiers syst√®me

# Restauration via PE/WinRE
copy C:\Backup\SYSTEM C:\Windows\System32\config\SYSTEM
# (n√©cessite arr√™t syst√®me)
```

## üéØ Cas d'Usage Fr√©quents

### Optimisation Syst√®me
```cmd
# D√©sactiver services inutiles
reg add "HKLM\SYSTEM\CurrentControlSet\Services\Fax" /v Start /t REG_DWORD /d 4

# Modifier d√©lai d√©marrage
reg add "HKLM\SYSTEM\CurrentControlSet\Control" /v WaitToKillServiceTimeout /t REG_SZ /d "5000"

# Optimiser menu D√©marrer
reg add "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v StartMenuAdminTools /t REG_DWORD /d 1
```

### Configuration R√©seau
```cmd
# Configuration TCP/IP via registre
reg add "HKLM\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters" /v TcpWindowSize /t REG_DWORD /d 65535

# Param√®tres DNS
reg query "HKLM\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters" /v NameServer
```

### Gestion Applications
```cmd
# D√©sactiver notifications Windows 10
reg add "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\PushNotifications" /v ToastEnabled /t REG_DWORD /d 0

# Configuration Windows Update
reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU" /v NoAutoUpdate /t REG_DWORD /d 1
```

## üí° Bonnes Pratiques

### S√©curit√©
- ‚úÖ **Toujours sauvegarder** avant modification
- ‚úÖ **Tester** modifications en environnement non-critique
- ‚úÖ **Utiliser PowerShell** pour scripts (gestion erreurs)
- ‚úÖ **V√©rifier permissions** avant modifications syst√®me
- ‚úÖ **Documenter** changements pour rollback

### Performance
- ‚úÖ **√âviter modifications** registre en production directement
- ‚úÖ **Utiliser GPO** quand possible (centralis√©, auditable)  
- ‚úÖ **Nettoyer** entr√©es obsol√®tes p√©riodiquement
- ‚úÖ **Monitoring** modifications via auditpol

### Maintenance
- ‚úÖ **Points restauration** avant changements importants
- ‚úÖ **Export registre** applications critiques
- ‚úÖ **V√©rification int√©grit√©** (`sfc /scannow`) mensuelle
- ‚úÖ **Scripts d√©ploiement** pour changements r√©p√©titifs
- ‚úÖ **Documentation** structure registre personnalis√©e

---
**üí° Memo** : Toujours sauvegarder (`reg export`) avant modification, utiliser PowerShell pour gestion erreurs, GPO > registre manuel !